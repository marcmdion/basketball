<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baller Scheduler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a1a1a; color: #e5e5e5; }
        h1, h2, h3, .scoreboard-font { font-family: 'Teko', sans-serif; }
        .court-bg {
            background-image: radial-gradient(circle at 50% 50%, #2a2a2a 0%, #1a1a1a 100%);
        }
        .glass-panel {
            background: rgba(40, 40, 40, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #ea580c; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #c2410c; }
        
        .timer-glow {
            text-shadow: 0 0 20px rgba(234, 88, 12, 0.5);
        }
        .active-player-card {
            background: linear-gradient(135deg, rgba(234, 88, 12, 0.1) 0%, rgba(0,0,0,0) 100%);
            border-left: 3px solid #ea580c;
        }
        
        /* Modal Animation */
        .modal-enter { animation: modalFadeIn 0.2s ease-out forwards; }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="court-bg min-h-screen flex flex-col">

    <!-- Header -->
    <header class="p-4 border-b border-gray-800 bg-black/50 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <i class="fas fa-basketball-ball text-orange-600 text-3xl animate-bounce"></i>
                <h1 class="text-3xl font-bold tracking-wide text-white">PICK-UP <span class="text-orange-600">SCHEDULER</span></h1>
            </div>
            
            <div class="flex flex-wrap items-center gap-4 text-sm">
                <!-- Start Time Input Removed -->
                <div class="flex items-center gap-2 bg-gray-800 px-3 py-1.5 rounded-lg border border-gray-700">
                    <i class="fas fa-hourglass-half text-gray-400"></i>
                    <span>Duration:</span>
                    <input type="number" id="gameDuration" value="15" min="5" max="60" onchange="updateScheduleTimes()" class="bg-transparent border-none focus:ring-0 text-white font-bold w-12 p-0 text-center"> min
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-6 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- LEFT COLUMN: Roster & Stats (3 cols) -->
        <section class="lg:col-span-3 flex flex-col gap-6">
            <!-- Roster Management -->
            <div class="glass-panel p-4 flex flex-col h-[50vh] lg:h-auto">
                <h2 class="text-xl text-orange-500 mb-3 flex justify-between items-center">
                    <span>ROSTER (<span id="playerCount">0</span>)</span>
                    <div class="flex gap-2">
                        <button onclick="clearAllPlayers()" class="text-xs text-gray-500 hover:text-red-500">Clear All</button>
                        <button onclick="resetAll()" class="text-xs text-gray-500 hover:text-blue-500">Reset Default</button>
                    </div>
                </h2>
                
                <div class="flex gap-2 mb-4">
                    <input type="text" id="newPlayerName" placeholder="Add Player..." 
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-orange-600"
                           onkeypress="handleEnter(event)">
                    <button onclick="addPlayer()" class="bg-orange-600 hover:bg-orange-700 text-white px-3 rounded-lg transition-colors">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>

                <div class="overflow-y-auto flex-grow pr-1 space-y-2" id="rosterList">
                    <!-- Roster items injected here -->
                </div>
            </div>

            <!-- Stats Tally -->
            <div class="glass-panel p-4 flex-grow overflow-hidden flex flex-col">
                <h2 class="text-xl text-gray-300 mb-2">GAMES PLAYED</h2>
                <div class="overflow-y-auto pr-1 flex-grow">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-500 uppercase border-b border-gray-700">
                            <tr>
                                <th class="py-2">Player</th>
                                <th class="py-2 text-right">GP</th>
                            </tr>
                        </thead>
                        <tbody id="statsTable" class="divide-y divide-gray-800">
                            <!-- Stats injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- CENTER COLUMN: Active Game (6 cols) -->
        <section class="lg:col-span-6 flex flex-col gap-6">
            <!-- Scoreboard & Timer -->
            <div class="glass-panel p-6 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orange-600 to-transparent"></div>
                
                <h2 id="gameTitle" class="text-2xl text-gray-400 tracking-widest mb-4">CURRENT GAME</h2>
                
                <!-- Timer -->
                <div class="mb-8">
                    <div id="timerDisplay" class="text-8xl md:text-9xl font-bold scoreboard-font timer-glow leading-none text-white transition-colors duration-300">15:00</div>
                    <div class="flex justify-center gap-4 mt-4">
                        <button onclick="toggleTimer()" id="timerBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold tracking-wide transition-all shadow-lg active:scale-95">START</button>
                        <button onclick="resetTimer()" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-full font-bold tracking-wide transition-all shadow-lg active:scale-95">RESET</button>
                    </div>
                </div>

                <!-- Scoreboard -->
                <div class="flex justify-between items-center max-w-md mx-auto bg-black/40 rounded-2xl p-4 border border-gray-800">
                    <div class="flex flex-col items-center w-1/3">
                        <span class="text-gray-400 font-bold mb-1">HOME</span>
                        <div class="text-5xl font-bold scoreboard-font text-white mb-2" id="scoreA">0</div>
                        <div class="flex gap-2">
                            <button onclick="adjustScore('A', -1)" class="w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-white">-</button>
                            <button onclick="adjustScore('A', 1)" class="w-8 h-8 rounded-full bg-orange-900/50 hover:bg-orange-600 border border-orange-800 text-orange-500 hover:text-white">+</button>
                        </div>
                    </div>
                    
                    <div class="text-gray-600 text-xl font-bold">VS</div>

                    <div class="flex flex-col items-center w-1/3">
                        <span class="text-gray-400 font-bold mb-1">AWAY</span>
                        <div class="text-5xl font-bold scoreboard-font text-white mb-2" id="scoreB">0</div>
                        <div class="flex gap-2">
                            <button onclick="adjustScore('B', -1)" class="w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-white">-</button>
                            <button onclick="adjustScore('B', 1)" class="w-8 h-8 rounded-full bg-orange-900/50 hover:bg-orange-600 border border-orange-800 text-orange-500 hover:text-white">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Players On Court -->
            <div class="glass-panel p-5 flex-grow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl text-orange-500">ON COURT</h3>
                    <button onclick="finishGame()" class="bg-orange-600 hover:bg-orange-500 text-white text-sm px-4 py-2 rounded-lg font-bold shadow-lg shadow-orange-900/20 transition-all hover:scale-105">
                        <i class="fas fa-check mr-2"></i>FINISH GAME
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4 h-full">
                    <!-- Team A List -->
                    <div class="bg-gray-900/50 rounded-xl p-3 border border-gray-800">
                        <h4 class="text-center text-gray-400 text-sm mb-3 uppercase tracking-wider">Home Team</h4>
                        <ul id="teamAList" class="space-y-2">
                            <li class="text-center text-gray-500 italic text-sm py-4">Waiting for players...</li>
                        </ul>
                    </div>

                    <!-- Team B List -->
                    <div class="bg-gray-900/50 rounded-xl p-3 border border-gray-800">
                        <h4 class="text-center text-gray-400 text-sm mb-3 uppercase tracking-wider">Away Team</h4>
                        <ul id="teamBList" class="space-y-2">
                            <li class="text-center text-gray-500 italic text-sm py-4">Waiting for players...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- RIGHT COLUMN: Schedule (3 cols) -->
        <section class="lg:col-span-3 flex flex-col h-full">
            <div class="glass-panel p-4 h-full flex flex-col">
                <h2 class="text-xl text-orange-500 mb-1">UPCOMING GAMES</h2>
                <p class="text-xs text-gray-500 mb-4">Auto-generated based on fair rotation.</p>
                
                <div id="scheduleContainer" class="overflow-y-auto space-y-3 pr-1 flex-grow h-[500px]">
                    <!-- Schedule Cards injected here -->
                </div>
            </div>
        </section>

    </main>

    <footer class="p-4 text-center text-gray-600 text-xs font-mono border-t border-gray-900">
        vibe coded by MarcDion
    </footer>

    <!-- Custom Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-700 rounded-xl p-6 max-w-sm w-full shadow-2xl modal-enter">
            <h3 class="text-xl text-white font-bold mb-2 tracking-wide">CONFIRM ACTION</h3>
            <p id="confirmMessage" class="text-gray-300 mb-6">Are you sure?</p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal()" class="px-4 py-2 rounded-lg bg-gray-800 text-gray-300 hover:bg-gray-700 font-medium transition-colors">Cancel</button>
                <button id="confirmBtn" class="px-4 py-2 rounded-lg bg-orange-600 text-white hover:bg-orange-500 font-bold transition-colors shadow-lg shadow-orange-900/20">Confirm</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- STATE MANAGEMENT ---
        const PRELOADED_PLAYERS = [
            "LeBron James", "Stephen Curry", "Kevin Durant", "Giannis A.", "Luka Doncic", 
            "Jayson Tatum", "Joel Embiid", "Nikola Jokic", "Ja Morant", "Devin Booker",
            "Jimmy Butler", "Damian Lillard", "Kyrie Irving", "Anthony Edwards", "Kawhi Leonard",
            "Paul George", "Donovan Mitchell", "Zion Williamson", "Trae Young", "Shai G.A."
        ];

        let players = []; // { id, name, gamesPlayed, consecutiveGames, active }
        let currentGameNumber = 1;
        let currentGame = {
            active: false,
            teamA: [],
            teamB: [],
            scoreA: 0,
            scoreB: 0,
            startTime: null
        };
        let timerInterval = null;
        let timeRemaining = 15 * 60; // seconds
        let isTimerRunning = false;

        // --- MODAL LOGIC ---
        let confirmCallback = null;

        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').innerText = message;
            confirmCallback = callback;
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            confirmCallback = null;
        }

        document.getElementById('confirmBtn').addEventListener('click', () => {
            if (confirmCallback) confirmCallback();
            closeModal();
        });

        // --- INITIALIZATION ---
        window.onload = function() {
            // Load preset players
            PRELOADED_PLAYERS.forEach(name => addPlayerToState(name));
            
            // Initial render
            renderRoster();
            recalculateSchedule();
            updateTimerDisplay();
        };

        // --- ROSTER LOGIC ---
        function addPlayer() {
            const input = document.getElementById('newPlayerName');
            const name = input.value.trim();
            if (name) {
                addPlayerToState(name);
                input.value = '';
                renderRoster();
                recalculateSchedule();
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addPlayer();
        }

        function addPlayerToState(name) {
            const id = Date.now().toString(36) + Math.random().toString(36).substr(2);
            players.push({
                id,
                name,
                gamesPlayed: 0,
                consecutiveGames: 0,
                active: true
            });
        }

        function togglePlayerStatus(id) {
            const player = players.find(p => p.id === id);
            if (player) {
                player.active = !player.active;
                renderRoster();
                recalculateSchedule();
            }
        }

        function removePlayer(id) {
            showConfirm("Remove player permanently?", () => {
                // Check if player is currently playing BEFORE removing them
                const isInCurrentGame = currentGame.teamA.some(p => p.id === id) || 
                                      currentGame.teamB.some(p => p.id === id);

                // Remove from roster
                players = players.filter(p => p.id !== id);

                // If they were in the current game, we must reset the current game
                // so it can be regenerated with valid players
                if (isInCurrentGame) {
                    currentGame.teamA = [];
                    currentGame.teamB = [];
                    currentGame.active = false;
                    
                    // Reset game state for fairness re-roll
                    currentGame.scoreA = 0;
                    currentGame.scoreB = 0;
                    document.getElementById('scoreA').innerText = '0';
                    document.getElementById('scoreB').innerText = '0';
                    resetTimer();
                }

                renderRoster();
                recalculateSchedule();
            });
        }

        // --- SCHEDULING ALGORITHM (THE BRAIN) ---
        function getFairTeams(availablePlayers, simulationHistory) {
            let pool = availablePlayers.filter(p => p.active);
            if (pool.length < 10) return null; // Not enough players

            let candidates = pool.map(p => {
                const simStat = simulationHistory[p.id] || { 
                    gp: p.gamesPlayed, 
                    con: p.consecutiveGames 
                };
                return { 
                    ...p, 
                    simGamesPlayed: simStat.gp, 
                    simConsecutive: simStat.con 
                };
            });

            const totalActive = pool.length;
            const isLargeGroup = totalActive >= 20;
            const maxConsecutive = isLargeGroup ? 0 : 1; 

            candidates.sort((a, b) => {
                const aRestNeeded = a.simConsecutive > maxConsecutive;
                const bRestNeeded = b.simConsecutive > maxConsecutive;

                if (aRestNeeded && !bRestNeeded) return 1; 
                if (!aRestNeeded && bRestNeeded) return -1; 
                
                if (a.simGamesPlayed !== b.simGamesPlayed) {
                    return a.simGamesPlayed - b.simGamesPlayed;
                }
                
                return 0.5 - Math.random();
            });

            const selected = candidates.slice(0, 10);
            const shuffled = selected.sort(() => 0.5 - Math.random());
            const teamA = shuffled.slice(0, 5);
            const teamB = shuffled.slice(5, 10);

            return { teamA, teamB, flatList: selected };
        }

        function recalculateSchedule() {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';

            let simHistory = {}; 
            
            // --- SIMULATION BASE STATE ---
            // If a game is active, we must "simulate" it having been played
            // so the prediction logic for the next game knows these players are tired/played.
            if (currentGame.active) {
                // Mark active players as having played an extra game in simulation
                const activeIds = [...currentGame.teamA, ...currentGame.teamB].map(p => p.id);
                
                players.forEach(p => {
                    if (activeIds.includes(p.id)) {
                        simHistory[p.id] = { gp: p.gamesPlayed + 1, con: p.consecutiveGames + 1 };
                    } else {
                        // Those who sat out the active game have con=0
                        simHistory[p.id] = { gp: p.gamesPlayed, con: 0 };
                    }
                });
            }

            // --- GENERATE SCHEDULE ---
            // If no active game, we generate it first (Game #X). 
            // If active game exists (Game #X), we start generating from Game #X+1.
            
            let upcomingStartNum = currentGameNumber;
            
            if (!currentGame.active) {
                const teams = getFairTeams(players, simHistory);
                if (teams) {
                    // This becomes our active game immediately
                    populateCurrentGame(teams.teamA, teams.teamB, upcomingStartNum);
                    
                    // Update simulation so next iteration knows about this game
                    teams.flatList.forEach(p => {
                        if (!simHistory[p.id]) simHistory[p.id] = { gp: p.gamesPlayed + 1, con: p.consecutiveGames + 1 };
                        else { simHistory[p.id].gp++; simHistory[p.id].con++; }
                    });
                    
                    // Reset others
                    const playedIds = teams.flatList.map(p => p.id);
                    players.forEach(p => {
                        if (p.active && !playedIds.includes(p.id)) {
                            if (!simHistory[p.id]) simHistory[p.id] = { gp: p.gamesPlayed, con: 0 };
                            else simHistory[p.id].con = 0;
                        }
                    });
                } else {
                    container.innerHTML = `<div class="text-center text-gray-500 py-4">Not enough active players (need 10+).</div>`;
                    return;
                }
            }

            // Upcoming list starts at Next Game
            upcomingStartNum = currentGameNumber + 1;

            // Generate next 8 games
            for (let i = 0; i < 8; i++) {
                const teams = getFairTeams(players, simHistory);
                if (!teams) break;

                const thisGameNum = upcomingStartNum + i;

                // Update Stats for next sim loop
                teams.flatList.forEach(p => {
                    if (!simHistory[p.id]) {
                        simHistory[p.id] = { gp: p.gamesPlayed + 1, con: p.consecutiveGames + 1 };
                    } else {
                        simHistory[p.id].gp += 1;
                        simHistory[p.id].con += 1;
                    }
                });

                // Reset consecutive for those who sat out
                const playedIds = teams.flatList.map(p => p.id);
                players.forEach(p => {
                    if (p.active && !playedIds.includes(p.id)) {
                        if (!simHistory[p.id]) simHistory[p.id] = { gp: p.gamesPlayed, con: 0 };
                        else simHistory[p.id].con = 0;
                    }
                });

                // Render
                const card = document.createElement('div');
                card.className = "bg-gray-800/50 border border-gray-700 rounded-lg p-3";
                card.innerHTML = `
                    <div class="flex justify-between text-xs text-orange-400 font-bold mb-2">
                        <span>GAME ${thisGameNum}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <div class="text-gray-500 text-xs mb-1">TEAM 1</div>
                            ${teams.teamA.map(p => `<div class="text-gray-300 truncate">${p.name}</div>`).join('')}
                        </div>
                        <div>
                            <div class="text-gray-500 text-xs mb-1">TEAM 2</div>
                            ${teams.teamB.map(p => `<div class="text-gray-300 truncate">${p.name}</div>`).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        // --- GAME LOGIC ---
        function populateCurrentGame(teamA, teamB, gameNum) {
            currentGame.teamA = teamA;
            currentGame.teamB = teamB;
            currentGame.active = true;
            
            // Update UI Title
            const titleEl = document.getElementById('gameTitle');
            if (titleEl) titleEl.innerText = `GAME ${gameNum}`;

            renderCurrentGame();
        }

        function renderCurrentGame() {
            const listA = document.getElementById('teamAList');
            const listB = document.getElementById('teamBList');
            
            if (currentGame.teamA.length === 0) {
                listA.innerHTML = '<li class="text-center text-gray-500 italic text-sm py-4">Waiting for schedule...</li>';
                listB.innerHTML = '<li class="text-center text-gray-500 italic text-sm py-4">Waiting for schedule...</li>';
                return;
            }

            const renderPlayer = (p) => `
                <li class="flex items-center justify-between active-player-card px-3 py-2 rounded mb-1">
                    <span class="font-medium text-white">${p.name}</span>
                    <span class="text-xs text-gray-500 bg-black/30 px-2 py-0.5 rounded">GP: ${p.gamesPlayed}</span>
                </li>
            `;

            listA.innerHTML = currentGame.teamA.map(renderPlayer).join('');
            listB.innerHTML = currentGame.teamB.map(renderPlayer).join('');
        }

        function finishGame() {
            if (currentGame.teamA.length === 0) return;
            
            showConfirm(`Finish Game ${currentGameNumber}?`, () => {
                // Update Stats for Real
                [...currentGame.teamA, ...currentGame.teamB].forEach(pRef => {
                    const realPlayer = players.find(p => p.id === pRef.id);
                    if (realPlayer) {
                        realPlayer.gamesPlayed++;
                        realPlayer.consecutiveGames++;
                    }
                });

                // Reset consecutive for those who sat out
                const allPlayingIds = [...currentGame.teamA, ...currentGame.teamB].map(p => p.id);
                players.forEach(p => {
                    if (!allPlayingIds.includes(p.id)) {
                        p.consecutiveGames = 0;
                    }
                });

                // Increment Game Number
                currentGameNumber++;

                // Reset Score & Timer
                document.getElementById('scoreA').innerText = '0';
                document.getElementById('scoreB').innerText = '0';
                currentGame.scoreA = 0;
                currentGame.scoreB = 0;
                resetTimer();

                // Clear Current
                currentGame.teamA = [];
                currentGame.teamB = [];
                currentGame.active = false;

                // Update UI
                renderRoster();
                recalculateSchedule(); // This will auto-fill the empty Current Game slot
            });
        }

        // --- TIMER LOGIC ---
        function updateTimerDisplay() {
            const m = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
            const s = (timeRemaining % 60).toString().padStart(2, '0');
            const el = document.getElementById('timerDisplay');
            el.innerText = `${m}:${s}`;
            
            if (timeRemaining <= 60 && timeRemaining > 0) el.classList.add('text-red-500');
            else el.classList.remove('text-red-500');
            
            if (timeRemaining === 0) {
                el.classList.add('text-red-600', 'animate-pulse');
            } else {
                el.classList.remove('text-red-600', 'animate-pulse');
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('timerBtn');
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                btn.innerText = "RESUME";
                btn.className = "bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold tracking-wide transition-all shadow-lg active:scale-95";
            } else {
                timerInterval = setInterval(() => {
                    if (timeRemaining > 0) {
                        timeRemaining--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                    }
                }, 1000);
                isTimerRunning = true;
                btn.innerText = "PAUSE";
                btn.className = "bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-full font-bold tracking-wide transition-all shadow-lg active:scale-95";
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            const duration = document.getElementById('gameDuration').value;
            timeRemaining = duration * 60;
            updateTimerDisplay();
            const btn = document.getElementById('timerBtn');
            btn.innerText = "START";
            btn.className = "bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold tracking-wide transition-all shadow-lg active:scale-95";
        }

        // --- UTILS & UI UPDATES ---
        function updateScheduleTimes() {
            const duration = parseInt(document.getElementById('gameDuration').value);
            
            // Update current timer if not running (e.g. before game start)
            if (!isTimerRunning) {
                timeRemaining = duration * 60;
                updateTimerDisplay();
            }
            
            recalculateSchedule();
        }

        function adjustScore(team, delta) {
            if (team === 'A') {
                currentGame.scoreA = Math.max(0, currentGame.scoreA + delta);
                document.getElementById('scoreA').innerText = currentGame.scoreA;
            } else {
                currentGame.scoreB = Math.max(0, currentGame.scoreB + delta);
                document.getElementById('scoreB').innerText = currentGame.scoreB;
            }
        }

        function renderRoster() {
            document.getElementById('playerCount').innerText = players.length;
            const list = document.getElementById('rosterList');
            const stats = document.getElementById('statsTable');
            
            list.innerHTML = '';
            stats.innerHTML = '';

            const sortedPlayers = [...players].sort((a, b) => a.name.localeCompare(b.name));

            sortedPlayers.forEach(p => {
                const item = document.createElement('div');
                item.className = `flex items-center justify-between p-2 rounded ${p.active ? 'bg-gray-800' : 'bg-gray-900 opacity-50'} border border-gray-700`;
                item.innerHTML = `
                    <div class="flex items-center gap-2 overflow-hidden">
                        <button onclick="togglePlayerStatus('${p.id}')" class="text-xs w-6 h-6 rounded-full flex items-center justify-center ${p.active ? 'bg-green-900 text-green-400' : 'bg-red-900 text-red-400'}">
                            <i class="fas ${p.active ? 'fa-check' : 'fa-times'}"></i>
                        </button>
                        <span class="truncate font-medium text-sm ${p.active ? 'text-white' : 'text-gray-500'}">${p.name}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-xs bg-gray-700 px-1.5 rounded text-gray-300" title="Games Played">GP:${p.gamesPlayed}</span>
                        <button onclick="removePlayer('${p.id}')" class="text-gray-600 hover:text-red-500 transition-colors"><i class="fas fa-trash-alt text-xs"></i></button>
                    </div>
                `;
                list.appendChild(item);

                const statRow = document.createElement('tr');
                statRow.className = "border-b border-gray-800 hover:bg-gray-800/50 transition-colors";
                statRow.innerHTML = `
                    <td class="py-2 px-1 font-medium text-gray-300 truncate max-w-[100px]">${p.name}</td>
                    <td class="py-2 px-1 text-right font-bold text-orange-500">${p.gamesPlayed}</td>
                `;
                stats.appendChild(statRow);
            });
        }
        
        function clearAllPlayers() {
            showConfirm("Delete all players? The roster will be empty.", () => {
                players = [];
                currentGameNumber = 1;
                currentGame = { active: false, teamA: [], teamB: [], scoreA: 0, scoreB: 0 };
                
                // Update UI elements for game
                document.getElementById('scoreA').innerText = '0';
                document.getElementById('scoreB').innerText = '0';
                
                resetTimer();
                renderRoster();
                recalculateSchedule();
            });
        }
        
        function resetAll() {
            showConfirm("Reset everything? Roster will revert to default.", () => {
                players = [];
                currentGameNumber = 1;
                PRELOADED_PLAYERS.forEach(name => addPlayerToState(name));
                currentGame = { active: false, teamA: [], teamB: [], scoreA: 0, scoreB: 0 };
                
                // Update UI elements for game
                document.getElementById('scoreA').innerText = '0';
                document.getElementById('scoreB').innerText = '0';
                
                resetTimer();
                renderRoster();
                recalculateSchedule();
            });
        }
    </script>
</body>
</html>
